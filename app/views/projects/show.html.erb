<h1><%= @project.id %> Project Show Page</h1>

<h2><%= @project.name %>, <%= @project.address %>, <%= @project.company %></h2>

<div class="container">
  <table>
    <tr>
        <th>Select</th>
        <th>Name</th>
        <th>Drawing No</th>
        <th>Revision</th>
        <th>Last Updated</th>
        <th>Updated By</th>
        <th>Open</th>
    </tr>
    <% @project.drawings.sort_by(&:name).each do |drawing| %>
      <tr>
        <td>Box</td>
        <td><%= drawing.name %></td>
        <td><%= drawing.number %></td>
        <td><%= drawing.revision %></td>
        <td>Date</td>
        <td>Author</td>
        <% if drawing.file.attached? %>
          <td>
            <%= link_to "Open", url_for(drawing.file) %>
            <%= link_to "Download", rails_blob_path(drawing.file, disposition: "attachment") %>
          </td>
        <% else %>
          <td>No file</td>
        <% end %>
        <td>
          <%= link_to "Edit", edit_project_drawing_path(@project, drawing) %>
          <%= link_to "Delete", project_drawing_path(@project, drawing), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
        </td>
      </tr>
        <% if drawing.versions.size > 0 %>
          <% drawing.versions.each do |version| %>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td><%= version.reify.revision %></td>
              <td>Date</td>
              <td>Author</td>
              <% if version.reify.file.attached? %>
                <td>
                  <%= link_to "Open", url_for(version.reify.file) %>
                  <%= link_to "Download", rails_blob_path(version.reify.file, disposition: "attachment") %>
                </td>
              <% else %>
                <td>No file</td>
              <% end %>
              <td></td>
            </tr>
          <% end %>
        <% end %>
    <% end %>
  </table>
</div>

<%= link_to "Add a drawing to this project", new_project_drawing_path(@project) %> |

<%= link_to "Back", projects_path %>

<% if policy(@project).edit? %>
   | <%= link_to "Edit", edit_project_path(@project) %> |
<% end %>
<% if policy(@project).destroy? %>
  <%= link_to "Delete", project_path(@project), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
<% end %>

<% if @project.users.any? %>
  <h3>Registered Users</h3>
  <% @project.users.each do |user| %>
    <p><%= user.email %></p>
  <% end %>
<% end %>

<%= link_to "Add users to this project", edit_project_path(@project) %>
